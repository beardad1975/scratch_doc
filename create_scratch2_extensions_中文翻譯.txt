----------------------
建立Scratch2.0擴充功能
----------------------


原始作者：John Maloney ，MIT Media Laboratory ，2013年9月
原文網址：http://wiki.scratch.mit.edu/w/images/ExtensionsDoc.HTTP-9-11.pdf
譯者：張文宏 ，2016年4月
翻譯原則：不採精確翻譯，以容易理解及實用為原則


【介紹】

Scratch2.0可以透過擴充功能來控制外部的裝置(如機器人套件，樂器等)，或是從外部感測器取得感測值(如感應板)。擴充功能幫Scrath增加了新的「命令」積木與「回報」積木，這些新增的積木可與裝置做互動。當啟用擴充功能時，新的積木會出現在「更多積木」區裡面。



由於瀏覽器的安全限制，Scratch2.0無法直接與硬體裝置溝通(譯註：Scratch一開始是Web版，且以Flash寫成)，所以擴充功能要透過另一個獨立執行的擴充程式。Scratch透過HTTP與擴充程式連結，然後擴充程式再與硬體裝置溝通。未來，一些擴充功能會以瀏覽器外掛的型式來做，但不在此詳述。(譯註：Scratch2離線版不使用瀏覽器外掛)

(譯註：擴充程式原文為helper app，為使文章易理解，而採此翻譯 )


這篇文章的讀者是針對Scratch2.0擴充功能開發者。內容提到了自訂積木檔格式(譯註：即.s2e檔)，Scratch與擴充程式的溝通協定及開發的步驟。

(譯註：自訂積木檔原文為Extension description file，為使文章易理解，而採此翻譯 )


【自訂積木檔 .s2e】

積木定義檔是一個採用JSON格式的文字檔。(譯註：JSON是來自Javascript，是Web常見的資料交換格式)，依Scratch2.0的習慣，採用.s2e的結尾副檔名。

在積木定義檔中的JSON物件包括了擴充的名稱，用來與擴充程式通訊的TCP/IP的port號碼，和一個Scratch積木內容的串列

以下方為例：

{ 
    "extensionName": "擴充示範",
    "extensionPort": 12345,
    "blockSpecs": [
        [" ", "嗶一聲", "playBeep"],
        [" ", "設定音量為 %n", "setVolume", 5],
        ["r", "目前音量值", "volume"],
    ]
}


擴充的名稱是「擴充示範」，然後擴充積木(Scratch)會用port 12345與擴充程式通訊。blockSpecs這個欄位描述了出現在「更多積木」區裡的自訂積木。在這個例子中，會有3個積木。第1個積木是會執行嗶一聲的命令積木；第2個是會設定音量的命令積木；第3個是可以讀取目前音量值的回報積木


【積木的描述】

每個自訂積木是以下列的欄位陣列來決定

    * 積木類型
    * 積木格式
    * 積木作用
    * (非必要) 多個預設的參數值

以下一個一個欄位說明

積木類型可使用下列的文字字串來決定

    " "  命令積木 (譯註：內有一空格)
    "w"  會等待的命令積木 
    "r"  數字回報積木(圓弧形積木)
    "b"  布林回報積木(六角型積木)

積木格式的值是一個文字字串，它會決定出現在積木上的文字與參數欄位，參數欄位會用一個以%開頭再加上一個英文字母來決定，如下：
  
    %n  數字的參數欄位(圓弧型空格)
    %s  文字的參數欄位(方型空格)
    %b  布林值的參數欄位(六角型空格)

在上方的例子中，"設定音量為 %n" 會讓積木有個數字的參數欄位，在第2個積木描述的最後有個5，代表參數欄位的預設值是5，這個預設值在會在一開始就出現在積木上，讓使用者方便測試並給他們一個參考值。

積木作用的值是文字字串，這個欄位有兩種用法。對命令積木來說，值會被送到擴充程式，連同參數值一起,讓擴充程式來執行命令動作。對回報積木來說，這個值是個感應值的變數名稱，感應值會保留在Scratch內部，當我們執行回報積木，其實是會得到最後收到的感應值。


【選單參數】

命令積木與回報積木都可以使用選單參數，如下：

    %m.menuName    不可編輯的選單參數
    %d.menuName    可以編輯的選單參數

第1種會有個下拉式選單的欄位，如同Scratch原有的「廣播」積木。第2種會有個可編輯的數字欄位同時也有下拉選單，如同Scratch原有的「面向方向」積木。對兩種選單而言，在點號(.)後的是選單的名稱。至於選單的內容，是在積木定義的後面，再加上menu的欄位。比如說，如果是要用MS的Kinect的擴充積木，可能會有如下的定義：






